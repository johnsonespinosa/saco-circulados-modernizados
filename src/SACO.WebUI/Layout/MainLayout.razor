@inherits LayoutComponentBase
@inject IUserContext UserContext
@inject NavigationManager NavigationManager

<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>

    <MudAppBar Elevation="1">
        <MudText Typo="Typo.h6">SACO — Sistema Automatizado de Circulaciones Operativas</MudText>
        <MudSpacer />
        @if (UserContext.GetCurrentUser() is not null)
        {
            <MudText Class="me-2">@UserContext.GetCurrentUser()?.UserName (@UserContext.GetCurrentUser()?.Rol)</MudText>
            <MudIconButton Icon="@Icons.Material.Filled.Logout" OnClick="@Logout" />
        }
    </MudAppBar>

    <MudDrawer Open="true" Elevation="1" ClipMode="DrawerClipMode.Always">
        <MudNavMenu>

            @if (UserContext.GetCurrentUser()?.Rol == "Supervisor")
            {
                <MudNavLink Href="/usuarios" Icon="@Icons.Material.Filled.Group">Gestión de Usuarios</MudNavLink>
                <MudNavLink Href="/auditoria" Icon="@Icons.Material.Filled.Security">Auditoría</MudNavLink>
            }

            @if (UserContext.GetCurrentUser()?.Rol == "Inspector")
            {
                <MudNavLink Href="/reportes" Icon="@Icons.Material.Filled.Assessment">Reportes</MudNavLink>
            }

            @if (UserContext.GetCurrentUser()?.Rol == "Operador")
            {
                <MudNavLink Href="/circulados" Icon="@Icons.Material.Filled.Mail">Circulados</MudNavLink>
            }

        </MudNavMenu>
    </MudDrawer>

    <MudMainContent>
        @Body
    </MudMainContent>

</MudLayout>

@code {
    private void Logout()
    {
        UserContext.CloseSession();
        NavigationManager.NavigateTo(uri: "/login", forceLoad: true);
    }
}